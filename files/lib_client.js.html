<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/client.js - basho-riak-client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="basho-riak-client" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.3.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AuthReq.html">AuthReq</a></li>
                                <li><a href="../classes/Client.html">Client</a></li>
                                <li><a href="../classes/CommandBase.html">CommandBase</a></li>
                                <li><a href="../classes/DefaultNodeManager.html">DefaultNodeManager</a></li>
                                <li><a href="../classes/DeleteIndex.html">DeleteIndex</a></li>
                                <li><a href="../classes/DeleteIndex.Builder.html">DeleteIndex.Builder</a></li>
                                <li><a href="../classes/DeleteValue.html">DeleteValue</a></li>
                                <li><a href="../classes/DeleteValue.Builder.html">DeleteValue.Builder</a></li>
                                <li><a href="../classes/FetchBucketProps.html">FetchBucketProps</a></li>
                                <li><a href="../classes/FetchBucketProps.Builder.html">FetchBucketProps.Builder</a></li>
                                <li><a href="../classes/FetchCounter.html">FetchCounter</a></li>
                                <li><a href="../classes/FetchCounter.Builder.html">FetchCounter.Builder</a></li>
                                <li><a href="../classes/FetchIndex.html">FetchIndex</a></li>
                                <li><a href="../classes/FetchIndex.Builder.html">FetchIndex.Builder</a></li>
                                <li><a href="../classes/FetchMap.html">FetchMap</a></li>
                                <li><a href="../classes/FetchMap.Builder.html">FetchMap.Builder</a></li>
                                <li><a href="../classes/FetchPreflist.html">FetchPreflist</a></li>
                                <li><a href="../classes/FetchPreflist.Builder.html">FetchPreflist.Builder</a></li>
                                <li><a href="../classes/FetchSchema.html">FetchSchema</a></li>
                                <li><a href="../classes/FetchSchema.Builder.html">FetchSchema.Builder</a></li>
                                <li><a href="../classes/FetchSet.html">FetchSet</a></li>
                                <li><a href="../classes/FetchSet.Builder.html">FetchSet.Builder</a></li>
                                <li><a href="../classes/FetchValue.html">FetchValue</a></li>
                                <li><a href="../classes/FetchValue.Builder.html">FetchValue.Builder</a></li>
                                <li><a href="../classes/ListBuckets.html">ListBuckets</a></li>
                                <li><a href="../classes/ListBuckets.Builder.html">ListBuckets.Builder</a></li>
                                <li><a href="../classes/ListKeys.html">ListKeys</a></li>
                                <li><a href="../classes/ListKeys.Builder.html">ListKeys.Builder</a></li>
                                <li><a href="../classes/MapReduce.html">MapReduce</a></li>
                                <li><a href="../classes/NodeManager.html">NodeManager</a></li>
                                <li><a href="../classes/Ping.html">Ping</a></li>
                                <li><a href="../classes/RiakCluster.html">RiakCluster</a></li>
                                <li><a href="../classes/RiakCluster.Builder.html">RiakCluster.Builder</a></li>
                                <li><a href="../classes/RiakConnection.html">RiakConnection</a></li>
                                <li><a href="../classes/RiakNode.html">RiakNode</a></li>
                                <li><a href="../classes/RiakNode.Builder.html">RiakNode.Builder</a></li>
                                <li><a href="../classes/RiakObject.html">RiakObject</a></li>
                                <li><a href="../classes/Search.html">Search</a></li>
                                <li><a href="../classes/Search.Builder.html">Search.Builder</a></li>
                                <li><a href="../classes/SecondaryIndexQuery.html">SecondaryIndexQuery</a></li>
                                <li><a href="../classes/SecondaryIndexQuery.Builder.html">SecondaryIndexQuery.Builder</a></li>
                                <li><a href="../classes/StartTls.html">StartTls</a></li>
                                <li><a href="../classes/StoreBucketProps.html">StoreBucketProps</a></li>
                                <li><a href="../classes/StoreBucketProps.Builder.html">StoreBucketProps.Builder</a></li>
                                <li><a href="../classes/StoreIndex.html">StoreIndex</a></li>
                                <li><a href="../classes/StoreIndex.Builder.html">StoreIndex.Builder</a></li>
                                <li><a href="../classes/StoreSchema.html">StoreSchema</a></li>
                                <li><a href="../classes/StoreSchema.Builder.html">StoreSchema.Builder</a></li>
                                <li><a href="../classes/StoreValue.html">StoreValue</a></li>
                                <li><a href="../classes/StoreValue.Builder.html">StoreValue.Builder</a></li>
                                <li><a href="../classes/UpdateCounter.html">UpdateCounter</a></li>
                                <li><a href="../classes/UpdateCounter.Builder.html">UpdateCounter.Builder</a></li>
                                <li><a href="../classes/UpdateMap.html">UpdateMap</a></li>
                                <li><a href="../classes/UpdateMap.Builder.html">UpdateMap.Builder</a></li>
                                <li><a href="../classes/UpdateMap.MapOperation.html">UpdateMap.MapOperation</a></li>
                                <li><a href="../classes/UpdateSet.html">UpdateSet</a></li>
                                <li><a href="../classes/UpdateSet.Builder.html">UpdateSet.Builder</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Client.html">Client</a></li>
                                <li><a href="../modules/Core.html">Core</a></li>
                                <li><a href="../modules/CRDT.html">CRDT</a></li>
                                <li><a href="../modules/KV.html">KV</a></li>
                                <li><a href="../modules/MR.html">MR</a></li>
                                <li><a href="../modules/YZ.html">YZ</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: lib/client.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * Copyright 2015 Basho Technologies, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

// Core modules
var Core = require(&#x27;./core/core&#x27;);

// Ping command
var Ping = require(&#x27;./commands/ping&#x27;);

// KV exports / commands
var KV = require(&#x27;./commands/kv&#x27;);

// CRDT exports / commands
var CRDT = require(&#x27;./commands/crdt&#x27;);

// Yokozuna exports / commands
var YZ = require(&#x27;./commands/yz&#x27;);

// Map-Reduce exports / commands
var MR = require(&#x27;./commands/mr&#x27;);

/**
 * Provides the Client class
 * @module Client
 */

/**
 * A Class that represents a Riak client.
 * 
 * The client constructor accepts a {{#crossLink &quot;RiakCluster&quot;}}{{/crossLink}}, or a list of host[:port] from
 * which it will create a RiakCluster using our default configuration. 
 * 
 *     var Riak = require(&#x27;riak&#x27;);
 *     var client = new Riak.Client([&#x27;192.168.1.1:8087&#x27;, &#x27;192.168.1.2:8087&#x27;]);
 *
 * Two styles of use are supported. Each command you can send to Riak is a 
 * class and can be instantiated then executed by the client&#x27;s execute() method.
 * In addition, convenience methods are provided directly by the Client class
 * that corrispond to each of the commands.
 * 
 *     // Using the builder, but options can also be passed directly to the constructor
 *     var fetch = new KV.FetchValue.Builder() 
 *                  .withBucket(&#x27;myBucket&#x27;)
 *                  .withKey(&#x27;myKey&#x27;)
 *                  .withCallback(callback)
 *                  .build();
 *                  
 *     client.execute(fetch);
 *     
 * or
 * 
 *     client.fetchValue({ bucket: &#x27;myBucket&#x27;, key: &#x27;myKey&#x27; }, callback);
 *     
 * All command callbacks are the typical node.js function(err, resp) style. 
 *
 * @class Client
 * @constructor
 * @param {String[]|RiakCluster} cluster - either an array of host[:port] strings or the cluster to use. See {{#crossLink &quot;RiakCluster&quot;}}{{/crossLink}}.
 */
function Client() {
    if (arguments.length === 1 &amp;&amp; arguments[0] instanceof Core.RiakCluster) {
        this.cluster = arguments[0];
        this.cluster.start();
    } else if (arguments.length) {
        var nodes = Core.RiakNode.buildNodes(arguments[0]);
        this.cluster = new Core.RiakCluster({ nodes: nodes});
        this.cluster.start();
    } else {
        throw new Error(&#x27;an array of IP|fqdn[:port] or an instance of RiakCluser is required&#x27;);
    }
}

/**
 * Shut down the client gracefully.
 * 
 * This will cause all connections to be closed and any remaining in-flight
 * commands to finish. 
 * 
 * The provided callback will be added as a stateChange listener to the client&#x27;s
 * RiakCluster.
 * 
 * See: {{#crossLink &quot;RiakCluster/stateChange:event&quot;}}RiakCluster.stateChange{{/crossLink}}
 * 
 * @method shutdown
 * @param {Function} callback - will be registered as a stateChange listener on the RiakCluster.
 */
Client.prototype.shutdown = function(callback) {
    this.cluster.on(&#x27;stateChange&#x27;, callback);
    this.cluster.stop();
};

/**
 * Get the client&#x27;s RiakCluster.
 * 
 * @method getRiakCluster
 * @return {Core.RiakCluster}
 */
Client.prototype.getRiakCluster = function() {
    return this.cluster;
};

/*
 * KV methods
 */

/**
 * See {{#crossLink &quot;RiakCluster/execute:method&quot;}}RiakCluster#execute{{/crossLink}}
 * @method execute
 * @param {Object} command Any Riak command object from the various modules.
 */
Client.prototype.execute = function(command) {
    this.cluster.execute(command);
};

/**
 * See {{#crossLink &quot;Ping&quot;}}{{/crossLink}}
 * @method ping
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.ping = function(callback) {
    var cmd = new Ping(callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;DeleteValue&quot;}}{{/crossLink}}
 * @method deleteValue
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.deleteValue = function(options, callback) {
    var cmd = new KV.DeleteValue(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;FetchBucketProps&quot;}}{{/crossLink}}
 * @method fetchBucketProps 
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.fetchBucketProps = function(options, callback) {
    var cmd = new KV.FetchBucketProps(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;FetchValue&quot;}}{{/crossLink}}
 * @method fetchValue
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.fetchValue = function(options, callback) {
    var cmd = new KV.FetchValue(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;ListBuckets&quot;}}{{/crossLink}}
 * @method ListBuckets
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.listBuckets = function(options, callback) {
    var cmd = new KV.ListBuckets(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;ListKeys&quot;}}{{/crossLink}}
 * @method listKeys
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.listKeys = function(options, callback) {
    var cmd = new KV.ListKeys(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;SecondaryIndexQuery&quot;}}{{/crossLink}}
 * @method secondaryIndexQuery
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.secondaryIndexQuery = function(options, callback) {
    var cmd = new KV.SecondaryIndexQuery(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;StoreBucketProps&quot;}}{{/crossLink}}
 * @method storeBucketProps
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.storeBucketProps = function(options, callback) {
    var cmd = new KV.StoreBucketProps(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;StoreValue&quot;}}{{/crossLink}}
 * @method storeValue
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.storeValue = function(options, callback) {
    var cmd = new KV.StoreValue(options, callback);
    this.cluster.execute(cmd);
};

/*
 * CRDT methods
 */

/**
 * See {{#crossLink &quot;FetchCounter&quot;}}{{/crossLink}}
 * @method fetchCounter
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.fetchCounter = function(options, callback) {
    var cmd = new CRDT.FetchCounter(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;UpdateCounter&quot;}}{{/crossLink}}
 * @method updateCounter
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.updateCounter = function(options, callback) {
    var cmd = new CRDT.UpdateCounter(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;FetchSet&quot;}}{{/crossLink}}
 * @method fetchSet
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.fetchSet = function(options, callback) {
    var cmd = new CRDT.FetchSet(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;UpdateSet&quot;}}{{/crossLink}}
 * @method updateSet
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.updateSet = function(options, callback) {
    var cmd = new CRDT.UpdateSet(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;FetchMap&quot;}}{{/crossLink}}
 * @method fetchMap
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.fetchMap = function(options, callback) {
    var cmd = new CRDT.FetchMap(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;UpdateMap&quot;}}{{/crossLink}}
 * @method updateMap
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.updateMap = function(options, callback) {
    var cmd = new CRDT.UpdateMap(options, callback);
    this.cluster.execute(cmd);
};

/*
 * YZ methods
 */

/**
 * See {{#crossLink &quot;DeleteIndex&quot;}}{{/crossLink}}
 * @method deleteIndex
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.deleteIndex = function(options, callback) {
    var cmd = new YZ.DeleteIndex(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;FetchIndex&quot;}}{{/crossLink}}
 * @method fetchIndex
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.fetchIndex = function(options, callback) {
    var cmd = new YZ.FetchIndex(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;FetchSchema&quot;}}{{/crossLink}}
 * @method fetchSchema
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.fetchSchema = function(options, callback) {
    var cmd = new YZ.FetchSchema(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;Search&quot;}}{{/crossLink}}
 * @method search
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.search = function(options, callback) {
    var cmd = new YZ.Search(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;StoreIndex&quot;}}{{/crossLink}}
 * @method storeIndex
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.storeIndex = function(options, callback) {
    var cmd = new YZ.StoreIndex(options, callback);
    this.cluster.execute(cmd);
};

/**
 * See {{#crossLink &quot;StoreSchema&quot;}}{{/crossLink}}
 * @method storeSchema
 * @param {Object} options The options for this operation.
 * @param {Function} callback The callback to be executed when the operation completes.
 */
Client.prototype.storeSchema = function(options, callback) {
    var cmd = new YZ.StoreSchema(options, callback);
    this.cluster.execute(cmd);
};

/*
 * MR 
 */

/**
 * See {{#crossLink &quot;MapReduce&quot;}}{{/crossLink}}
 * @method mapReduce
 * @param {String} query The map-reduce query. 
 * @param {Function} callback The callback to be executed when the operation completes.
 * @param {Boolean} [stream=true] Stream the results or accumulate before calling callback.
 * 
 */
Client.prototype.mapReduce = function(query, callback, stream) {
    var cmd = new MR.MapReduce(query, callback, stream);
    this.cluster.execute(cmd);
};


// Namespaces
function Riak() { }
function Commands() { }

// Core exports
module.exports = Riak;
module.exports.Client = Client;

module.exports.Node = Core.RiakNode;
module.exports.Cluster = Core.RiakCluster;

// Command exports
module.exports.Commands = Commands;
module.exports.Commands.Ping = Ping;

module.exports.Commands.KV = KV;
module.exports.Commands.CRDT = CRDT;
module.exports.Commands.YZ = YZ;
module.exports.Commands.MR = MR;


    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
